<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jhta.mybatis.StoresMapper">
	<select id="myPositionList" parameterType="hashmap" resultType="storeslist">
		select * from
		(select aa.*, rownum rnum from
		(select s.*, i.sto_img, se.sel_email
			from stores s, category c, sto_image i, seller se
			where s.cat_num=c.cat_num and s.sto_num=i.sto_num and c.cat_num=#{cat_num} and s.sto_state='승인' and s.sel_num = se.sel_num
			and s.sto_num in(select sto_num from able_location where able_loc=#{able_loc}))aa)
		    <![CDATA[where rnum>=${startRow} and rnum <= ${endRow}]]>
	</select>
	<select id="minStoNum" parameterType="int" resultType="int">
		select nvl(min(sto_num), 0) from stores where sel_num = #{sel_num} and sto_state='승인'
	</select>
	<select id="stoList" parameterType="int" resultType="stores">
		select * from stores where sel_num = #{sel_num} and sto_state='승인'
	</select>
	<select id="stoName" parameterType="int" resultType="stores">
		select s.*,s.sto_num,i.sto_img from (select * from stores where sto_state='승인' and sto_num=#{sto_num})s, sto_image i where s.sto_num=i.sto_num
	</select>
	<select id="count" resultType="int">
		select NVL(count(*),0) cnt from stores
	</select>
	<insert id="stInsert" parameterType="hashmap">
		insert into stores values(0,#{sto_name},#{sto_regnum},#{sto_addr},#{sto_phone},sysdate,
		to_date('20180501' || #{sto_open}, 'yyyymmdd hh24:mi'),to_date('20180501' || #{sto_close}, 'yyyymmdd hh24:mi'),
		#{sto_holiday},#{sto_intro},'대기',#{sel_num},#{cat_num})
	</insert>
</mapper>